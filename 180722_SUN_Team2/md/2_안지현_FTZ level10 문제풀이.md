## FTZ level10 풀이 

------------------------------------------

### 01 문제 파악 

공유 메모리에 데이터 읽고 쓰기  ! 



문제를 파악하기 전에 다음의 자료를 읽고 오면 좀 더 이해하기 쉽다. 

* 공유메모리란? 

  > https://ko.wikipedia.org/wiki/%EA%B3%B5%EC%9C%A0_%EB%A9%94%EB%AA%A8%EB%A6%AC

* 공유메모리란? (2) 

  > 기존 프로세스가 독립된 메모리 공간을 할당받고 다른 프로세스의 메모리 공간은 접근이 불가능한데 반해 메모리 공간을 여러 프로세스가 함께 접근해서 공유할 수 있는 공간을 말한다. 
  > 과다한 복사를 피하거나 해당 프로그램 간 통신을 위해 고안되었다.
  > (원래 프로세스는 해당 프로세스가 할당된 메모리만을 사용할 수가 있다.) 



문제는 다음과 같다  

![10](https://user-images.githubusercontent.com/40850499/43044851-0026c6b6-8de9-11e8-98d6-7a4a138674f1.png)

여기서 알 수 있는 키워드는 "공유메모리"와 "key_t의 값이 7530" 이라고 적혀있다. 

이것을 이용할 생각을 하자



### 02 의도 분석 

공유메모리의 개념 및 공유메모리와 관련된 소스코드의 구성을 알아야 한다

→   공유메모리 취약점 분석 기본기 다지기 



### 03 나의 풀이 

우선 문제를 다시 한 번 보자 

![10](https://user-images.githubusercontent.com/40850499/43044851-0026c6b6-8de9-11e8-98d6-7a4a138674f1.png)

공유메모리 관련된 문제라는 것을 알았으나 "key_t값은 7530" 이라는 말이 무엇인지 모르겠어서

공유메모리 관련 명령어인 ipcs를 입력했다. 

![ipcs](https://user-images.githubusercontent.com/40850499/43044856-1c5d73fc-8de9-11e8-8bad-955d4f7ef27f.JPG)

공유메모리 세그먼트에 한가지 목록이 뜬다.  

여기서 눈여겨 봐야할 것은 key, owner, perms, bytes라는 4가지 값이다.  

root 권한을 가진 사람이 존재하고 퍼미션은 666이라고 한다. byte의 크기는 1028byte이다. 



key값의 16진수인 수를 10진수로 변환해봤다. 

![16](https://user-images.githubusercontent.com/40850499/43044857-265dfa3e-8de9-11e8-913a-f376ca2bf93c.JPG)

7530이라는 10진수 값이 나왔다. 

이 key_t값 7530을 통해 해당 공유메모리에 접근할 수 있는 것 같다.  

따라서 key_t 7530 위치에 접근하는 소스코드를 작성하자. 

현재 디렉토리에서는 cat 명령어로 .c파일을 만들 수 없으니까 /tmp 임시파일 디렉토리로 이동하고 코딩을 했다. 

![tmp](https://user-images.githubusercontent.com/40850499/43044861-34a61e32-8de9-11e8-911b-d25a5981d1cc.JPG)

//위 코드에는 잘못 코딩한 부분이 두 군데 있다. (포인터 선언에 ';' 누락, shmat함수 세번째 인자값은 알파벳 'o'가 아니라 숫자 '0'이다. ㅋㅋ)

//수정 후 캡쳐한 화면이 없어서 그냥 이 사진을 사용했다. 

공유메모리를 사용하는 함수는 shmget(공유메모리를 요청하는 함수), shmat(공유메모리를 사용가능하게 만드는 함수)가 있다. 

shmget함수로 해당 공유메모리에 요청을 한 후 

shmat함수를 이용해서 해당 메모리를 사용가능하도록 만든다. 

리턴값은 공유메모리의 주소값을 반환한다. 



프로그램을 작성 후 gcc로 컴파일을 했다. 

![gcc _pw](https://user-images.githubusercontent.com/40850499/43044864-3d530144-8de9-11e8-931f-6991dbb07e0a.jpg

컴파일했더니 smemory 파일이 생겼다. 

실행하니 password가 나왔다 !  



### 04 새로 알게된 것 

  1) 공유 메모리 개념 및 필요성

  2) 공유 메모리 관련 함수와 그 사용법 



#### *참고자료 

* 여동기. 『문제 풀이로 배우는 시스템 해킹 테크닉』. 위키북스, 2015. 
* 우스이 토시노리 외 7인. 『CTF 정보보안 콘테스트 챌린지 북』. 위키북스, 2016.  
* 공유메모리 및 관련함수(shmget,shmat)에 대한 자세한 설명 참고
  https://www.joinc.co.kr/w/Site/system_programing/IPC/SharedMemory
